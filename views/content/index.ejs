<!DOCTYPE html>
<html lang="en">
  <%
  function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

%>
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Mobile Survey Kota Salatiga">
    <meta name="author" content="Pemerintah Kota Salatiga | Bappelitbangda Kota Salatiga">
    <link rel="shortcut icon" href="/images/template/shortcut_icon.ico">
    <title>Mobile Survey Kota Salatiga</title>

    <!-- <link href="/stylesheets/template/css/theme.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <!-- <link href="/stylesheets/template/css/style.css" rel="stylesheet"> -->
    <link href="/stylesheets/template/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <!-- Plugin This Page -->
    

    <link href="/resources-maps/stylesheets/leaflet-routing-machine.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/L.Control.Locate.min.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet-routing-machine.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.extra-markers.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.label.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/groupedlayercontrol.css" rel="stylesheet"/>
    <link href="/resources-maps/stylesheets/leaflet.draw.css" rel="stylesheet"/>
    <link href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" rel="stylesheet"> 
    <link href="/resources-maps/stylesheets/Control.FullScreen.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css" rel="stylesheet"/>
    <link href="https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css"
    rel="stylesheet"/>
    <link href="/plugins/fancybox/css/jquery.fancybox.css" rel="stylesheet">


    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet-src.js"></script>
    <script src="https://unpkg.com/esri-leaflet@2.1.1/dist/esri-leaflet.js"
       integrity="sha512-ECQqaYZke9cSdqlFG08zSkudgrdF6I1d8ViSa7I3VIszJyVqw4ng1G8sehEXlumdMnFYfzY0tMgdQa4WCs9IUw=="
       crossorigin=""></script>
       <script src="/plugins/jquery/jquery-1.11.1.min.js"></script>
       <script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
       <script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>
       <script src="/plugins/fancybox/js/jquery.fancybox.js"></script>
       <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
       <script src="/resources-maps/javascripts/leaflet-routing-machine.js"></script>
       <script src="/resources-maps/javascripts/leaflet.label.js"></script>
       <script src="/resources-maps/panah-asmara.js"></script>
       <script src="https://maps.google.com/maps/api/js?v=3.2&key=AIzaSyBy8irzccEOp7ezf5nQ2UPaLGcte_AEsOQ"></script>
       <script src='https://unpkg.com/leaflet.gridlayer.googlemutant@latest/dist/Leaflet.GoogleMutant.js'></script>
       <script src="/resources-maps/javascripts/L.Control.Locate.js" ></script>
       <script src="/resources-maps/javascripts/leaflet-routing-machine.js"></script>
       <script src="/resources-maps/javascripts/leaflet.extra-markers.js"></script>
       <script src="/resources-maps/javascripts/leaflet-image.js"></script>
       <script src="https://d3js.org/topojson.v1.min.js"></script>
       <script src="/resources-maps/javascripts/Control.FullScreen.js"></script>
       <script src="/resources-maps/javascripts/groupedlayercontrol.js"></script>
       <script src="/resources-maps/javascripts/wicket.js"></script>
       <script src="/resources-maps/javascripts/wicket-leaflet.js"></script>
       <script src="/resources-maps/javascripts/leaflet-omnivore.min.js"></script>
       <script src="/resources-maps/draw/Leaflet.draw.js"></script>
       <script src="/resources-maps/draw/Leaflet.Draw.Event.js"></script>
       <script src="/resources-maps/draw/Toolbar.js"></script>
       <script src="/resources-maps/draw/Tooltip.js"></script>
       <script src="/resources-maps/draw/ext/GeometryUtil.js"></script>
       <script src="/resources-maps/draw/ext/LatLngUtil.js"></script>
       <script src="/resources-maps/draw/ext/LineUtil.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/Polygon.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/Polyline.Intersect.js"></script>
       <script src="/resources-maps/draw/ext/TouchEvents.js"></script>
       <script src="/resources-maps/draw/draw/DrawToolbar.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Feature.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.SimpleShape.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Polyline.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Marker.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Polygon.js"></script>
       <script src="/resources-maps/draw/draw/handler/Draw.Rectangle.js"></script>
       <script src="/resources-maps/draw/edit/EditToolbar.js"></script>
       <script src="/resources-maps/draw/edit/handler/EditToolbar.Edit.js"></script>
       <script src="/resources-maps/draw/edit/handler/EditToolbar.Delete.js"></script>
       <script src="/resources-maps/draw/Control.Draw.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Poly.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.SimpleShape.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Rectangle.js"></script>
       <script src="/resources-maps/draw/edit/handler/Edit.Marker.js"></script> 
       <script src="/resources-maps/main.js"></script>
    <!-- End Plugins This Page -->

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        html {
            font-family: "avenir";

        }

        @font-face {
            font-family: "avenir";
            src: url('/stylesheets/template/fonts/Avenir.ttf');
        }

        /* #map{
          mask: url('/images/template/Untitled-6.png');
          -webkit-mask: url('/images/template/Untitled-6.png');
          -webkit-mask-repeat: no-repeat;
          mask-repeat: no-repeat;
          -webkit-mask-position: left;
          mask-position: left;
          -webkit-mask-size: cover;
          mask-size:cover;     
        } */

        h1,h2,h3,h4,h5,h6{
          margin:0;
        }

       .ku .modal-lg{
          max-width: 1000px !important;
        }


        /*---------------------------------------------------------------------
      Tab
    -----------------------------------------------------------------------*/
	.tab .nav-tabs {
		width: 18%;
		float: left;
		display: inline-block;
		border: none;
		margin-right: 4%;
	}
	
	.tab .nav-tabs li {
		display: inline-block;
		width: 100%;
		padding: 0;
		margin: 0px;
		text-align: center;
	}
	
	.tab .nav-tabs li a {
		border: 1px solid #dddddd;
		color: #353535;
		border-bottom: none;
		background: #fff;
		padding: 15px;
		border-radius: 0;
		margin: 0px;
		-webkit-transition: all .3s ease;
		-o-transition: all .3s ease;
		transition: all .3s ease;
	}
	
	.tab .nav-tabs li:last-child a {
		border-bottom: 1px solid #dddddd;
	}
	
	.tab .nav-tabs li a i {
		font-size: 38px;
		display: inline-block;
		width: 100%;
		line-height: normal;
	}
	
	.tab .nav-tabs li a span {
		font-size: 16px;
		line-height: 24px;
	}
	
	.tab .nav-tabs li.active a:before {
		position: absolute;
		margin-top: -25px;
		content: "\f0da";
		font-family: fontawesome;
		right: -10px;
		top: 50%;
		font-size: 36px;
		color: #002863;
	}
	
	.tab .nav-tabs li.active a,
	.tab .nav-tabs li a:hover,
	.top_dark .nav-tabs li.active a:hover>a:focus {
		background: #002863;
		color: #FE9E2E;
		border: 1px solid #073D7D;
		border-bottom: none;
		border-right: none;
		position: relative;
	}
	
	/*----------------------
		  TAB content
		-----------------------*/
	.tab .tab-content {
		width: 78%;
		float: left;
	}
	
	.tab .tab-content .img-left {
		float: left;
		margin-right: 15px;
		margin-bottom: 15px;
	}
	
	.tab .tab-content .img-right {
		float: right;
		margin-left: 15px;
		margin-bottom: 15px;
	}
	
	.tab .tab-content .title {
		font-size: 28px;
		font-weight: 500;
		color: #ffd200;
		line-height: normal;
		margin-top: 0px;
		margin-bottom: 15px;
	}
	
	.tab .tab-content .list li {
		margin-bottom: 5px;
	}
	
	.tab .tab-content .list li i {
		margin-right: 5px;
	}
	
	.list li i {
		color: #ffd200;
	}
	
	.tab .tab-content img.img-left {
		margin-bottom: 0;
	}
	
	/* Dark BG */
	.text-white .tab.tab-default .nav-tabs li a {
		background: none;
		color: #f5f5f5;
	}
	
	.text-white .tab.tab-default .nav-tabs li.active a,
	.text-white .tab.tab-default .nav-tabs li a:hover,
	.text-white .tab.tab-default .nav-tabs li.active a:hover>a:focus {
		background: #ffd200;
	}
	
	
	/*------------------------------------
		  TAB - Border
		-------------------------------------*/
	.tab.tab-bor {
		border: 1px solid #dddddd;
	}
	
	.tab.tab-bor .nav-tabs {
		width: 100%;
		margin: 0px;
	}
	
	.tab.tab-bor .nav-tabs li {
		margin-right: 0;
		width: 20%;
		border-bottom: 1px solid #e6e6e6;
		border-right: 1px solid #e6e6e6;
		background: #f9f9f9;
	}
	
	.tab.tab-bor .nav-tabs li:last-child {
		margin-right: 0px;
		border-right: none;
	}
	
	.tab.tab-bor .nav-tabs li.active {
		border-bottom: none;
		background: none;
	}
	
	.tab.tab-bor .nav-tabs li a {
		border: none;
		display: table;
		background: none;
		padding: 12px 10px;
		width: 100%;
		position: relative;
	}
	
	.tab.tab-bor .nav-tabs li a i {
		text-align: right;
		vertical-align: middle;
		width: auto;
		margin-right: 10px;
	}
	
	.tab.tab-bor .nav-tabs li a span {
		text-align: left;
		vertical-align: middle;
	}
	
	.tab.tab-bor .nav-tabs li a:before,
	.tab.tab-bor .nav-tabs li a:after {
		content: normal;
		margin: 0;
	}
	
	.tab.tab-bor .nav-tabs li a:before {
		content: "";
		width: 0;
		height: 4px;
		background: #ffd200;
		position: absolute;
		top: -1px;
		left: 50%;
		-webkit-transition: all .3s ease;
		-o-transition: all .3s ease;
		transition: all .3s ease;
	}
	
	.tab.tab-bor .nav-tabs li.active a:before {
		width: 100%;
		left: 0;
	}
	
	.tab.tab-bor .nav-tabs li.active a,
	.tab.tab-bor .nav-tabs li a:hover {
		color: #ffd200;
	}
	
	.tab.tab-bor .tab-content {
		width: 100%;
		margin-top: 0;
		padding: 30px;
	}
	
	/* Dark BG */
	.text-white .tab.tab-bor .nav-tabs li {
		background: none;
	}
	
	.text-white .tab.tab-bor .nav-tabs li a {
		color: #ffffff;
	}
	
	.text-white .tab.tab-bor .nav-tabs li.active a {
		color: #ffd200;
	}
	
	/*-------------------------------------
		   TAB - Vertical
		-------------------------------------*/
	.tab.tab-vertical {
		border: 1px solid #e7e7e7;
		width: 100%;
		overflow: hidden;
	}
	
	.tab.tab-vertical .nav-tabs {
		margin-right: 0;
		width: 30%;
		border-bottom: 1px solid #e7e7e7;
		position: relative;
		z-index: 9;
	}
	
	.tab.tab-vertical .nav-tabs:before {
		background: #f9f9f9;
		border-right: 1px solid #e7e7e7;
		display: block;
		content: "";
		height: 99.8%;
		position: absolute;
		left: 0;
		bottom: -100%;
		width: 100%;
		z-index: 0;
	}
	
	.tab.tab-vertical .nav-tabs li {
		text-align: left;
	}
	
	.tab.tab-vertical .nav-tabs li a {
		background: #f9f9f9;
		font-weight: 400;
		display: inline-block;
		width: 100%;
		border: 1px solid #e7e7e7;
		border-left: none;
		border-bottom: none;
		padding: 15px 20px 15px 40px;
	}
	
	.tab.tab-vertical .nav-tabs li:first-child a {
		border-top: none;
	}
	
	.tab.tab-vertical .nav-tabs li a i {
		float: left;
		width: auto;
		margin-right: 20px;
	}
	
	.tab.tab-vertical .nav-tabs li a span {
		line-height: 46px;
	}
	
	.tab.tab-vertical .nav-tabs li a::before {
		background: #ffd200;
		content: "";
		height: 100%;
		left: -6px;
		margin-top: 0;
		position: absolute;
		right: inherit;
		top: 0;
		width: 5px;
		opacity: 0;
	}
	
	.tab.tab-vertical .nav-tabs li.active a::before,
	.tab.tab-vertical .nav-tabs li a:hover:before {
		left: -1px;
		opacity: 1;
		-webkit-transition: all .3s ease;
		-o-transition: all .3s ease;
		transition: all .3s ease;
	}
	
	.tab.tab-vertical .nav-tabs li.active a,
	.tab.tab-vertical .nav-tabs li a:hover,
	.tab.tab-vertical .nav-tabs li.active a:hover>a:focus {
		background: #fff;
		color: #ffd200;
		border-right: none;
		border-bottom: none;
		position: relative;
	}
	
	.tab.tab-vertical .nav-tabs li.active a {
		border-top-color: #e7e7e7 !important;
	}
	
	.tab.tab-vertical .tab-content {
		width: 70%;
		padding: 50px;
	}
	
	/*-------------------------------------
		   TAB - Light
		--------------------------------------*/
	.tab.tab-light .nav-tabs {
		width: 100%;
		margin: 0px;
		margin-bottom: -1px;
		border-bottom: 1px solid #e6e6e6;
		text-align: center;
	}
	
	.tab.tab-light .nav-tabs li {
		margin-right: 0;
		width: auto;
		float: none;
		margin: 0 1px;
		border: 1px solid #e0e0e0;
		background: #e0e0e0;
		border-bottom: none;
	}
	
	.tab.tab-light .nav-tabs li:last-child {
		margin-right: 0px;
	}
	
	.tab.tab-light .nav-tabs li.active {
		border-bottom: none;
		background: none;
	}
	
	.tab.tab-light .nav-tabs li a {
		border: none;
		display: block;
		background: none;
		padding: 18px 25px;
		color: #fff;
		position: relative;
	}
	
	.tab.tab-light .nav-tabs li a i {
		display: none;
	}
	
	.tab.tab-light .nav-tabs li a span {
		text-align: left;
		vertical-align: middle;
	}
	
	.tab.tab-light .nav-tabs li.active a {
		color: #000;
	}
	
	.tab.tab-light .nav-tabs li a:before {
		content: "";
		width: 0;
		height: 3px;
		margin: 0;
		background: #e0e0e0;
		position: absolute;
		left: 50%;
		top: -1px;
		-webkit-transition: all .3s ease;
		-o-transition: all .3s ease;
		transition: all .3s ease;
	}
	
	.tab.tab-light .nav-tabs li.active a:before {
		width: 100%;
		left: 0;
	}
	
	.tab.tab-light .nav-tabs li.active a:after {
		content: "";
		width: 100%;
		height: 2px;
		margin: 0;
		background: #ffffff;
		position: absolute;
		left: 0;
		bottom: -2px;
	}
	
	.tab.tab-light .tab-content {
		width: 100%;
		margin-top: 30px;
	}
	
	/* Dark BG */
	.text-white .tab.tab-light .nav-tabs li {
		background: none;
	}
	
	.text-white .tab.tab-light .nav-tabs li a {
		color: #ffffff;
	}
	
	.text-white .tab.tab-light .nav-tabs li.active a {
		color: #ffd200;
	}
	
	.text-white .tab.tab-light .nav-tabs li.active a:after {
		background: #151515;
	}
    </style>
</head>

<body>
    
    <section style="position: relative;">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-4 col-lg-4" style="padding-left: 0;padding-right: 0;">
                  <div style="width: 100%;background-color: #f4f4f2;padding: 15px;max-height: 100vh;overflow-y: scroll;">
                    <div class="row">
                      <div class="col-md-12 col-lg-12">
                        <div style="width: 100%;height: 65px;display: flex;align-items: center;justify-content: center;">
                          <img src="/images/template/logo kota salatiga.png" alt="" style="height: 65px;">
                          <div style="display: flex;flex-direction: column;margin-left: 15px;">
                              <h4 style="margin-top: 0;margin-bottom: 0;"><strong>BAPPELITBANGDA</strong></h4>
                              <h4 style="margin-top: 0;margin-bottom: 0;letter-spacing: 2.5px;"><strong>KOTA SALATIGA</strong></h4>
                          </div>
                         </div>
                      </div>
                    </div>

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>MOBILE SURVEY RENCANA PEMBANGUNAN</strong></h6>
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>KOTA SALATIGA</strong></h6>
                      </div>
                    </div>

                    <!-- <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <div style="width: 100%;height: 4px;border-top-left-radius: 2px;border-bottom-left-radius: 2px;border-top-right-radius: 2px;border-bottom-right-radius: 2px;background-color: #174955;"></div>
                      </div>
                    </div> -->

                    <!-- <div class="row">
                      <div class="col-md-12 col-lg-12">
                        <form action="#">
                          <div class="row">
                            <div class="col-md-12 col-lg-12">
                              <h4><strong>PENCARIAN DATA </strong></h4>
                            </div>
                          </div>

                          <div class="row" style="margin-top: 15px;">
                            <div class="col-md-12 col-lg-12">
                              <select class="form-control" name="" id="">
                                <option value="">--Pilih Tahun--</option>
                                <%for(let i =2019; i < 2051; i++){%>
                                  <option value="<%=i%>"><%=i%></option>
                                  <%}%>
                              </select>
                            </div>
                          </div>

                          <div class="row" style="margin-top: 15px;">
                            <div class="col-md-12 col-lg-12">
                              <button class="btn btn-primary"> Cari</button>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div> -->

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <div style="width: 100%;height: 4px;border-top-left-radius: 2px;border-bottom-left-radius: 2px;border-top-right-radius: 2px;border-bottom-right-radius: 2px;background-color: #174955;"></div>
                      </div>
                    </div>

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>JUMLAH USULAN KEGIATAN</strong></h6>
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>PER KECAMATAN</strong></h6>
                      </div>


                  
                    </div>


                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
                          <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true" style="font-weight:bold">GRAFIK</a>
                          </li>
                          <li class="nav-item" role="presentation">
                            <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false" style="font-weight:bold">DATA</a>
                          </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                          <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                            <div class="row" style="margin-top: 15px;">
                              <div class="col-md-12 col-lg-12">
                                <div style="width: 100%;height: 500px;" id="chartContainer1"></div>
                              </div>
                            </div>
                          </div>
                          <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                            <div class="row" style="margin-top: 15px;">
                              <div class="col-md-12 col-lg-12">
                                <table class="table table-bordered">
                                  <thead>
                                      <tr>
                                          <th>No.</th>
                                          <th>Kecamatan</th>
                                          <th>Jumlah Kegiatan</th>
                                          <th>Option</th>
                                      </tr>
                                  </thead>
          
                                  <tbody id="tabel_kec">
                                  
                                  </tbody>
                                </table>
                              </div>
                            </div>
                            
                          </div>
                        </div>
                        

                      </div>
                    </div>

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <div style="width: 100%;height: 4px;border-top-left-radius: 2px;border-bottom-left-radius: 2px;border-top-right-radius: 2px;border-bottom-right-radius: 2px;background-color: #174955;"></div>
                      </div>
                    </div>

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>JUMLAH USULAN KEGIATAN</strong></h6>
                        <h6 style="margin-top: 0;margin-bottom: 0;text-align: center;"><strong>PER JENIS PEKERJAAN</strong></h6>
                      </div>
                    </div>

                    <div class="row" style="margin-top: 15px;">
                      <div class="col-md-12 col-lg-12">
                        <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
                          <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="jp-home-tab" data-toggle="tab" href="#jp-home" role="tab" aria-controls="jp-home" aria-selected="true"  style="font-weight:bold">GRAFIK</a>
                          </li>
                          <li class="nav-item" role="presentation">
                            <a class="nav-link" id="jp-profile-tab" data-toggle="tab" href="#jp-profile" role="tab" aria-controls="jp-profile" aria-selected="false"  style="font-weight:bold">DATA</a>
                          </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                          <div class="tab-pane fade show active" id="jp-home" role="tabpanel" aria-labelledby="jp-home-tab">
                            <div class="row" style="margin-top: 15px;">
                              <div class="col-md-12 col-lg-12">
                                <div style="width: 100%;height: 500px;" id="jenis_pekerjaan"></div>
                              </div>
                            </div>
                          </div>
                          <div class="tab-pane fade" id="jp-profile" role="tabpanel" aria-labelledby="jp-profile-tab">
                            <div class="row" style="margin-top: 15px;">
                              <div class="col-md-12 col-lg-12">
                                <table class="table table-bordered">
                                  <thead>
                                      <tr>
                                          <th>No.</th>
                                          <th>Jenis</th>
                                          <th>Jumlah Kegiatan</th>
                                          <th>Option</th>
                                      </tr>
                                  </thead>
          
                                  <tbody id="tabel_jenis">
                                  
                                  </tbody>
                                </table>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-8 col-lg-8" style="padding-left: 0;padding-right: 0;">
                  <div style="width: 100%;position: relative;">
                    <div style="width: 100%;height: 100vh;" id="map"></div>
                    <div style="width: 85%;display: flex;align-items: center;background-color: rgba(255, 255, 255, 0.7);padding:5px;border-radius:4px;z-index: 1000;position: absolute;left:0;right:0;top:13px;margin:auto">
                      <div style="width: 45%;">
                          <select class="form-control" name="" id="kec">
                            <option value="">--Pilih Kecamatan--</option>
                            <%for(let i =0; i < kecc.length; i++){%>
                              <option value="<%=kecc[i].nama_kecamatan%>" xe="<%=kecc[i].xe%>" ye="<%=kecc[i].ye%>"><%=kecc[i].nama_kecamatan%></option>
                              <%}%>
                          </select>
                      </div>
                      <div style="width: 2%;"></div>
                      <div  style="width: 45%;">
                          <select class="form-control" name="" id="desa">
                         
                          </select>
                      </div>
                      <div style="width: 2%;"></div>
                      <div  style="width: 45%;">
                        <select class="form-control" name="" id="tahun">
                          <%for(let i =2019; i < 2051; i++){%>
                            <option value="<%=i%>"><%=i%></option>
                            <%}%>
                        </select>
                      </div>
                    </div>
                  </div>
                  
              </div>
            </div>
        </div>

        <div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">DATA USULAN <span id="nama_kec" style="text-transform: uppercase;"></span>  </h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <table class="table table-bordered table-striped table-hover" id="example">
                  <thead>
                    <tr>
                        <th>No.</th>
                        <th>Kegiatan</th>
                        <th>Alamat</th>
                        <th>Kelurahan</th>

                        <th>Koordinat</th>
                        <th>Jenis Pekerjaan</th>
                        <!-- <th>Volume</th>
                        <th>Satuan</th>
                        <th>Jumlah Anggaran</th> -->
                        <th>Foto</th>
                        
                     
                    </tr>
                  </thead>
    
                  <tbody id="tabelKegiatan">
                      <tr>
                          <td>-</td>
                          <td>-</td>
                          <td>-</td>
                          <td>-</td>
                          <td>-</td>
                          <td>-</td>
                          <td>-</td>
                          <!-- <td>-</td>
                 
                          <td>-</td>
                          <td>-</td> -->
              
                      </tr>
                  </tbody>
                </table>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>





        
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
    <!-- Plugins This Page -->

    <!-- End Plugins This Page -->
    <script type="text/javascript">
    function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

    var kec = <%- JSON.stringify(kec) %>
    var tabel_pop_up;
    $(document).ready(function() {
       tabel_pop_up= $('#example').DataTable();
    });
    $('#konten-kel').hide();

    $('#kec').change(function() {
                console.log($('option:selected', this).attr('xe'))
                map.setView(new L.LatLng($('option:selected', this).attr('ye'), $('option:selected', this).attr('xe')), 13);
               $.ajax({
                 type : "GET",
                 async : false,
                 global : false,
                 url :  "/kegiatan/kel/"+$('#kec').val(),
                 dataType : 'json',
                 success: function (data) {
                  $("#desa").empty();
                  $("#desa").append('<option value="">-- Pilih Kelurahan/Desa --</option>')
                $.each(data, function(){
                     $("#desa").append('<option value="'+ this.nama_kelurahan +'" xe="'+ this.xe +'" ye="'+ this.ye +'" >'+ this.nama_kelurahan +'</option>')
                 })
                   
                 }
               });            
           });


           $('#desa').change(function() {
            map.setView(new L.LatLng($('option:selected', this).attr('ye'), $('option:selected', this).attr('xe')), 15);
                     
           });

           $('#tahun').change(function(){
         
            $.ajax({
                              type : "GET",
                              async : false,
                              global : false,
                              url : "/get_kec_by_tahun/"+$('#tahun').val(),
                              dataType : 'json',
                              success: function (data) {                                
                                $("#tabel_kec").empty();
                                $.each(data, function(index, item){
                                    $("#tabel_kec").append('<tr><td>'+(index+1)+'</td><td>'+item.label+'</td><td style="text-align:right">'+item.y+'</td><td><center><button class="btn btn-primary btn-sm" onclick="detail(\''+item.label+'\',\''+$('#tahun').val()+'\', \'kecamatan\')">Detail</button></center></td></tr>')
                                })
                                var chart1 = new CanvasJS.Chart("chartContainer1", {
                                            backgroundColor:'transparent',
                                          animationEnabled: true,
                                          axisX:{
                                              labelFontSize: 14,
                                          },

                                          axisY:{
                                              labelFontSize: 14,
                                          },
                                          // toolTip: {
                                          // 	shared: true
                                          // },
                                          
                                          data: [{
                                            type: "column",
                                            // name: "Kegiatan",
                                            // legendText: "Proven Oil Reserves",
                                            // showInLegend: true, 
                                            dataPoints:data
                                          }]
                                        });
                                        chart1.render();
                              }
        })

        //jenis
        $.ajax({
                              type : "GET",
                              async : false,
                              global : false,
                              url : "/get_keg_by_jenis/"+$('#tahun').val(),
                              dataType : 'json',
                              success: function (data) {    
                                $("#tabel_jenis").empty()                            
                                $.each(data, function(index, item){
                                    $("#tabel_jenis").append('<tr><td>'+(index+1)+'</td><td>'+item.label+'</td><td style="text-align:right">'+item.y+'</td><td><center><button class="btn btn-primary btn-sm" onclick="detail(\''+item.label+'\',\''+$('#tahun').val()+'\', \'jenis\')">Detail</button></center></td></tr>')
                                })
                                
                                var chart2 = new CanvasJS.Chart("jenis_pekerjaan", {
                                            backgroundColor:'transparent',
                                          animationEnabled: true,
                                          axisX:{
                                              labelFontSize: 14,
                                              interval:1,
                                              labelAngle: 90,
                                          },

                                          axisY:{
                                              labelFontSize: 14,
                                          },
                                          // toolTip: {
                                          // 	shared: true
                                          // },
                                          
                                          data: [{
                                            type: "column",
                                            // name: "Kegiatan",
                                            // legendText: "Proven Oil Reserves",
                                            // showInLegend: true, 
                                            dataPoints: data
                                          }]
                                        });


                                        // chart.render();

                                        chart2.render();
                              }
        })

         
    })
  
  window.onload = function () {



  

  }

  

function detilkec(kec){
        $("#data_panjang_by_kec").empty()
        
        $("#nama_kec").html(kec);
        console.log();
        $.ajax({
                              type : "GET",
                              async : false,
                              global : false,
                              url : "/get_kel_bykec/"+kec,
                              dataType : 'json',
                              success: function (data) {                                
                                  console.log(data)
                                $.each(data, function(index, item){
                                    $("#data_panjang_by_kec").append('<tr><td>'+(index+1)+'</td><td>'+item.label+'</td><td style="text-align:right">'+item.y+'</td><td><center><button class="btn btn-primary btn-sm" onclick="detilkel(\''+item.label+'\')">Detail</button></center></td></tr>')
                                })
                                var datane=[];
                                datane=data;
                                
                                    // panjang by kec

                                    var chart2 = new CanvasJS.Chart("chartContainer2", {
                                          animationEnabled: true,
                                          axisX:{
                                              labelFontSize: 14,
                                          },

                                          axisY:{
                                              labelFontSize: 14,
                                          },
                                          toolTip: {
                                            shared: true
                                          },
                                          
                                          data: [{
                                            type: "column",
                                            name: "Kegiatan",
                                            // legendText: "Proven Oil Reserves",
                                            showInLegend: true, 
                                            dataPoints:datane
                                          }]
                                        });

                                    

                                    chart2.render();
                              }
        })
                $('#konten-kel').show();
            
            $('html, body').animate({
              scrollTop: $("#konten-kel").offset().top
            }, 1000);
    }

    function detilkel(kel){
      console.log(kel);
      $("#nama_kel").html(kel);
        tabel_pop_up.clear()
        tabel_pop_up.draw()
        $.ajax({
                              type : "GET",
                              async : false,
                              global : false,
                              url : "/kegiatan_by_kel/"+kel,
                              dataType : 'json',
                              success: function (data) { 
                                // console.log(data);
                                $.each(data, function(index, item){
                                  console.log(item);
                                    tabel_pop_up.row.add([
                                            (index+1),
                                            item.kegiatanPrioritas,
                                            item.lokasi,
                                            ''+item.SHAPE.coordinates[0].toFixed(4)+','+item.SHAPE.coordinates[1].toFixed(4)+'',
                                            item.jenis,
                                            // item.kec,
                                            // item.kel,
                                            // item.volume,
                                            // item.jenisAnggaran,
                                            // item.jumlahAnggaran,
                                            '<img src="/foto/'+item.foto1+'" style="width:200px;height:200px">',
                                            // item.pelaksana,
                                            // item.namakesesuaian                                      
                                        ]).draw();

                       })
                      $("#exampleModal2").modal("toggle");
                              }
                            })
    }

    function detail(kec, tahun, jns){
    var url =""
      if(jns == "kecamatan"){
        $("#nama_kec").html('KECAMATAN '+kec);
        url= "/kegiatan_by_kec/"+kec+'/'+$('#tahun').val()
      }else{
        $("#nama_kec").html('JENIS '+kec);
        url= "/kegiatan_by_jenis/"+kec+'/'+$('#tahun').val()
      }
      
        tabel_pop_up.clear()
        tabel_pop_up.draw()
        $.ajax({
                              type : "GET",
                              async : false,
                              global : false,
                              url : url,
                              dataType : 'json',
                              success: function (data) { 
                                // console.log(data);
                                $.each(data, function(index, item){
                                  // console.log(item);
                                  let koordinat = "-";
                                  if(item.SHAPE){
                                    koordinat = ''+item.SHAPE.coordinates[1].toFixed(4)+','+item.SHAPE.coordinates[0].toFixed(4)+''
                                  }
                                    tabel_pop_up.row.add([
                                            (index+1),
                                            item.kegiatanPrioritas,
                                            item.lokasi,
                                            item.kel,
                                            '<a href="https://www.google.com/maps/dir/Current+Location/'+koordinat+'" target="_blank">'+koordinat+'</a>',
                                            // koordinat,
                                            item.jenis,
                                            
                                            // item.kec,
                                            // item.kel,
                                            // item.volume,
                                            // item.satuan,
                                            // item.jumlahAnggaran,
                                            '<div style="width:160px;height:160px;position:relative"><a href="/foto/'+item.foto1+'" data-fancybox="'+item.id+'"><img src="/foto/'+item.foto1+'" style="width:160px;height:160px"></a><a href="/foto/'+item.foto2+'" data-fancybox="'+item.id+'" style="display:none"><img src="/foto/'+item.foto2+'" style="width:60px;height:60px"></a><a href="/foto/'+item.foto3+'" data-fancybox="'+item.id+'" style="display:none"><img src="/foto/'+item.foto3+'" style="width:60px;height:60px"></a></div>',
                                            // item.pelaksana,
                                            // item.namakesesuaian                                      
                                        ]).draw();

                       })
                      $("#exampleModal2").modal("toggle");
                              }
                            })
    }


      function toWKT (layer) {
              var lng, lat, coords = [];
             if (layer instanceof L.Polygon || layer instanceof L.Polyline) {
               var latlngs = layer.getLatLngs();
             for (var i = 0; i < latlngs.length; i++) {
                 var latlngs1 = latlngs[i];
                 if (latlngs1.length){
                 for (var j = 0; j < latlngs1.length; j++) {
                   coords.push(latlngs1[j].lng + " " + latlngs1[j].lat);
                   if (j === 0) {
                     lng = latlngs1[j].lng;
                     lat = latlngs1[j].lat;
                   }
                 }}
                 else
                 {
                   coords.push(latlngs[i].lng + " " + latlngs[i].lat);
                   if (i === 0) {
                     lng = latlngs[i].lng;
                     lat = latlngs[i].lat;
                   }}
             };
               if (layer instanceof L.Polygon) {
                 return "POLYGON((" + coords.join(",") + "," + lng + " " + lat + "))";
               } else if (layer instanceof L.Polyline) {
                 return "LINESTRING(" + coords.join(",") + ")";
               }
             } else if (layer instanceof L.Marker) {
               return "POINT(" + layer.getLatLng().lng + " " + layer.getLatLng().lat + ")";
             }
           };
        $(document).ready(function() {
   
        
               $("#parsepeta").on("click", function () {
                drawnItems.clearLayers();
                inputan_koordinat ="";
                end_koordinat = "";
              var tableHtml=$('table.order-list')  // tableHtml is a jQuery of the table

              tableHtml.find('tbody > tr').each(function(){ 
                   
                                   if(inputan_koordinat==""){
                     end_koordinat= ''+$(this).find('input[name^="x"]').val() +' '+$(this).find('input[name^="y"]').val()
                    }
                                  inputan_koordinat = inputan_koordinat+''+$(this).find('input[name^="x"]').val() +' '+$(this).find('input[name^="y"]').val()+',';
              });
            inputan_koordinat = inputan_koordinat + end_koordinat;
              console.log(inputan_koordinat);
             layer_parse=   omnivore.wkt.parse('POLYGON(('+inputan_koordinat+'))');

             $('#wkt').val('POLYGON(('+inputan_koordinat+'))');
                   layer_parse.eachLayer(function (layer) {

                                      var bounds = layer.getBounds();
                                      map.fitBounds(bounds)
                        //         // Get center of bounds
                                 var center = bounds.getCenter();
                        

                       drawnItems.addLayer(layer);
                      })
              });
                     $("#reset_peta").on("click", function () {
                     drawnItems.clearLayers();
                      
                          
                                           $('#myTable tbody').html('<tr><td><input type="text" name="x[]" style="width:100%"/></td><td><input type="text" name="y[]" style="width:100%"/></td><td><a class="deleteRow" style="width:100%"></a></td> </tr>');
                                            $('#wkt').empty();
                     
                    });
                       $("#addrow").on("click", function () {

                   counter = $('#myTable tr').length - 2;

                   var newRow = $("<tr>");
                   var cols = "";

                   cols += '<td><input type="text" name="x[]" style="width:100%"/></td>';
                   cols += '<td><input type="text" name="y[]" style="width:100%"/></td>';

                   cols += '<td><input type="button" class="ibtnDel"  value="Hapus" style="width:100%"></td>';
                   newRow.append(cols);
                 //  if (counter == 4) $('#addrow').attr('disabled', true).prop('value', "You've reached the limit");
                   $("table.order-list").append(newRow);
                   counter++;
                   $("table.order-list").on("click", ".ibtnDel", function (event) {
                       $(this).closest("tr").remove();
                   
                       
                       counter -= 1
                       $('#addrow').attr('disabled', false).prop('value', "Tambah Koordinat");
                   });
                   //  var price = +row.find('input[name^="price"]').val();
               });
            
        });
     

         var warna_total = ['#ffffff','#ffffff'];
              var labels = ['',''];
               var wkt = new Wkt.Wkt();
          function onLocationFound(e) {
              var radius = e.accuracy / 2;
              
              if(center == 0 ){
                map.setView(e.latlng, 13);
                center++;
              }
             //   var koordinat = {latlng:{lat: ye, lng: xe}};
             
                
             //console.log(koordinat)
              clickHandler(e)
              // iht_layer.eachLayer(function (layer) {
              //   layer_lat_long = layer.getLatLng();
              //   layer_lat = layer.getLatLng().lat;
              //   layer_lng = layer.getLatLng().lng;

              //   // jarak ke point saat ini dalam meter
              //   var posisi_kita_lat = e.latlng.lat;
              //   var posisi_kita_lng = e.latlng.lng;

              //   jarak = layer_lat_long.distanceTo(e.latlng);

              //   var popupContent = getPopup( layer, posisi_kita_lat, posisi_kita_lng, layer_lat, layer_lng );
              //   layer.bindPopup(popupContent, popupOptions);
              //   if(jarak > 30000){
              //      // layer.setOpacity(0);
              //      // layer.unbindPopup();
              //   }
              // });
            }
          

            
            function ke_lokasi(x_awal, y_awal, x_akhir, y_akhir){
              map.closePopup();
              console.log(x_awal+ ' , ' +y_awal+ ' ; ' +x_akhir + ' , ' + y_akhir)

              if(navigasi!=null){
                navigasi.spliceWaypoints(navigasi.getWaypoints().length - 1, 1, L.latLng(x_akhir, y_akhir));   
              }
              else{
                navigasi =  L.Routing.control({
                  // waypointIcon :
                  // waypoints : [L.latLng(x_awal, y_awal), L.latLng(x_akhir, y_akhir)]
                  plan: L.Routing.plan([
                      L.latLng(x_awal, y_awal),
                      L.latLng(x_akhir, y_akhir)
                  ], 
                  {
                    createMarker: function(i, wp) {
                      return L.marker(wp.latLng, {
                        draggable: false,
                        icon: routeIcon
                      });
                    }
                    // geocoder: L.Control.Geocoder.nominatim(),
                    // routeWhileDragging: true
                  })
                });
                navigasi.addTo(map);
                console.log(navigasi.getPlan());
                $('.leaflet-routing-container').append('<a href="#" id="tutup_navigasi" onclick="tutup_navigasi()">BATAL</a>');
              }
            }
            
            function tutup_navigasi() {
              if(navigasi!=null){
                navigasi.spliceWaypoints(0, 2);
                $('.leaflet-routing-container').hide();
                navigasi = null;
              }
            }

            function tambah_titik(x, y, id_jalan){

              map.panTo(new L.LatLng(x, y));
              map.setZoom(16);

              jalan_layer.eachLayer(function (layer) {
                if ( layer.feature.properties.id_jalan == id_jalan ) {
                  console.log(layer.feature.properties)
                  layer.openPopup();
                };
              });
            }

            $('#cari').click(function(){
              var xe =  $('#xe').val();
              var ye = $('#ye').val();
            
              map.setView( new L.LatLng(ye, xe), 16)
             
             
                 peta_pemohon("POINT("+xe+" "+ye+")")
             //console.log(koordinat)
             // clickHandler(koordinat)
                return false 
            })


            /**
             * 
             *  Variables Initialization
             * 
             */
            var kabupaten_layer;
            var iht_layer = null;
            var source = null;
            var marker;
            var lingkaran;
            var center = 0;
            var navigasi=null;
            var kabupaten_layer;
            var marker_search='';

            /**
             * 
             *  Layer Styling
             * 
             */
            var sembunyi = {
              color : "transparent",
              weight : 1,
              opacity : 0,
              fillOpacity : 0
            };
            
             var style_kabupaten = {
                  color : "yellow", 
                  weight : 3, 
                  opacity : 1, 
                  fillOpacity  : 0,
                  dashArray : 3
                };
             var style_gambar = {
                  color : "blue", 
                  weight : 2, 
                  opacity : 1, 
                  fillOpacity  : 0
                  
                };
                 var style_desa = {
                  color : "white", 
                  weight : 1, 
                  opacity : 1, 
                  fillOpacity  : 0,
                  dashArray : 3
                };
             var style_polaruang = {
              color : "cyan", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.3,
              dashArray : 3
            };
             var style_perikanan = {
              color : "#C1EFFD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_hutan_lindung = {
              color : "#DFFFEA", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_pertahanan = {
              color : "#F224C6", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };
             var style_hutan_produksi_terbatas = {
              color : "#B2E8E8", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_hutan_produksi_tetap = {
              color : "#99F2CD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            

            var style_kawasan_industri = {
              color : "#E4E8B3", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_permukiman = {
              color : "#FCDB2B", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_pertanian_lahan_basah = {
              color : "#CBFFB5", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_pertanian_lahan_kering = {
              color : "#95FEBD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_rth = {
              color : "#97FEC0", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_sempadan_pantai = {
              color : "#CCFFCC", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_sempadan_sungai = {
              color : "#C1FFCD", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0.7,
              dashArray : 3
            };

            var style_kawasan_tanaman_pangan = {
              color : "#98f442", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  :0.7,
              dashArray : 3
            };

            var style_lppb = {
              color : "#2ECC71", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  :0.7,
              dashArray : 3
            };

          

            var style_kabupaten_gelap = {
              color : "#000", 
              weight : 1, 
              opacity : 1, 
              fillOpacity  : 0,
              dashArray : 3
            };
            
            var popupOptions = {
              maxWidth : '450',
              minWidth : '250',
              className : 'custom',
              closeOnClick : true
            };

            /**
             * 
             *  Map initialization
             * 
            . The Longitude of Kota Pati is 
             */
            var southWest = L.latLng(-8.629903118263488, 108.0780029296875),
              northEast = L.latLng(-6.124169589851178, 112.52746582031249),
              bounds = L.latLngBounds(southWest, northEast);
            var map = L.map('map', {
                center: [ -7.33194, 110.49278],
                // maxBounds: bounds,
                zoom: 13,
                minZoom:2,
                maxZoom:19,
                fullscreenControl: true,
                fullscreenControlOptions: {
                  position: 'topleft'
                }
            });


            //ngilangi garis putih
    



              function clickHandler(e) {
             
   //  var clickBounds = L.latLngBounds(e.latlng, e.latlng);

   //  var intersectingFeatures = [];
   //    for (var l in map._layers) {
   //    var overlay = map._layers[l];
   //    if (overlay._layers) {
   //      for (var f in overlay._layers) {
   //        var feature = overlay._layers[f];
   //        var bounds;
   //        if (feature.getBounds) bounds = feature.getBounds();
   //        else if (feature._latlng) {
   //          bounds = L.latLngBounds(feature._latlng, feature._latlng);
   //        }
   //        if (bounds && clickBounds.intersects(bounds)) {
   //          intersectingFeatures.push(feature);
   //        }
   //      }
   //    }
   //  }
   // intersectingFeatures.map(function(o) {
   //    console.log(o)
   //  })
   //  var html = "Found features: " + intersectingFeatures.length + "<br/>" + intersectingFeatures.map(function(o) {
   //    return o.feature
   //  }).join('<br/>');
   $('#xe').val(e.latlng.lng) 
   $('#ye').val(e.latlng.lat) 
  var html ="";
   
    html = html + "</br></br>Pola Ruang RTRW : </br>"
   $.ajax({
            type : "GET",
            async : false,
            global : false,
            url : root + "peta/list_polaruang?x="+e.latlng.lng+"&y="+e.latlng.lat,
            dataType : 'json',
            success: function (data) {
           // console.log(data)
           $.each(data, function(){
                html = html + this.rencana_tg+"</br>";
            })
              
            }
          });

   html = html + "</br>Koordinat : </br>"
    html = html + "</br>"+e.latlng.lng+" "+e.latlng.lat+"</br>"

    
       
    map.openPopup(html, e.latlng);
  }




            // map.fitBounds(bounds);

            var google_roadmap    = L.gridLayer.googleMutant({
                                                            type: 'roadmap',
                                                            styles: [
                                                                        {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                                                                        {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
                                                                        {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                                                                        {
                                                                          featureType: 'administrative.locality',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi.park',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#263c3f'}]
                                                                        },
                                                                        {
                                                                          featureType: 'poi.park',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#6b9a76'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#38414e'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'geometry.stroke',
                                                                          stylers: [{color: '#212a37'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#9ca5b3'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#746855'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'geometry.stroke',
                                                                          stylers: [{color: '#1f2835'}]
                                                                        },
                                                                        {
                                                                          featureType: 'road.highway',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#f3d19c'}]
                                                                        },
                                                                        {
                                                                          featureType: 'transit',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#2f3948'}]
                                                                        },
                                                                        {
                                                                          featureType: 'transit.station',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#d59563'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'geometry',
                                                                          stylers: [{color: '#17263c'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'labels.text.fill',
                                                                          stylers: [{color: '#515c6d'}]
                                                                        },
                                                                        {
                                                                          featureType: 'water',
                                                                          elementType: 'labels.text.stroke',
                                                                          stylers: [{color: '#17263c'}]
                                                                        }
                                                                      ]
                                                       // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })

            var google_hybrid     = L.gridLayer.googleMutant({
                                                            type: 'hybrid' // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })
            var google_satelit    = L.gridLayer.googleMutant({
                                                            type: 'satellite' // valid values are 'roadmap', 'satellite', 'terrain' and 'hybrid'
                                                        })
            var osm               = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {});
            var Esri_WorldImagery = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}');
           // var RBI            = L.tileLayer('http://portal.ina-sdi.or.id/arcgis/rest/services/IGD/RupabumiIndonesia/MapServer');

            var RBI =  L.esri.tiledMapLayer({
              url: "https://portal.ina-sdi.or.id/arcgis/rest/services/IGD/RupabumiIndonesia/MapServer"
            });
                           (function(){
                var originalInitTile = L.GridLayer.prototype._initTile
                L.GridLayer.include({
                    _initTile: function (tile) {
                        originalInitTile.call(this, tile);

                        var tileSize = this.getTileSize();

                        tile.style.width = tileSize.x + 1 + 'px';
                        tile.style.height = tileSize.y + 1 + 'px';
                    }
                });
            })()
            map.addLayer(google_hybrid);

            var legend = L.control({position: 'bottomleft'});
            var streetview = L.control({position: 'bottomright'});
            
            //gambar
            var drawnItems = L.featureGroup().addTo(map);
            var options = {
                  position: 'topleft',
                  draw: {
                      polyline: false,
                      polygon: true,
                      circle: false, // Turns off this drawing tool
                      rectangle: false,
                      marker: false
                  },
                  edit: {
                      featureGroup: drawnItems, //REQUIRED!!
                      remove: true
                  }
              };
              
              var drawControl = new L.Control.Draw(options);
              // map.addControl(drawControl);
              
               map.on(L.Draw.Event.CREATED, function(event) {
                 drawnItems.clearLayers();
                  var layer = event.layer;
                //  $('#wkt').val(toWKT(layer))
                  drawnItems.addLayer(layer);
                   peta_pemohon(toWKT(layer))
                //   $("#xe").val(layer.getLatLng().lng)
                // $("#ye").val(layer.getLatLng().lat)
                });

               map.on(L.Draw.Event.EDITED, function(event) {
                 drawnItems.clearLayers();
                  var layers = event.layers;
                     $("#xe").val(layers.getLatLng().lng)
                $("#ye").val(layers.getLatLng().lat)
                   // layers.eachLayer(function (layer) {
                         //do whatever you want; most likely save back to db
                        //  console.log(layer)     
                    //       peta_pemohon(toWKT(layer))
                     //});
               
                });
            //gambar end 



            var locateIcon = L.ExtraMarkers.icon({
                icon: 'fa-map-marker', 
                markerColor: 'blue-dark', 
                prefix: 'fa',
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconAktif = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'green-light', 
                icon: 'fa-building', 
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconTidakAktif = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'red', 
                icon: 'fa-ban', 
                iconColor: 'white',
                shape: 'square'
            });

            var ihtIconTidakDiketahui = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'orange', 
                icon: 'fa-question', 
                iconColor: 'white',
                shape: 'square'
            });

            var routeIcon = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'red', 
                icon: 'fa-location-arrow', 
                iconColor: 'white',
                shape: 'square'
            });

            // $.getJSON( root + "index.php/kabupaten", function( json ) {
            //   $.each(json, function( i, item ) {
            //     $('#kabupaten').append('<option value="'+item.id_kabupaten+'">'+item.nama_kabupaten+'</option>');
            //   })
            // });
          //ambil ksp  
          var label_kec = [];
          var label_desa = [];
      var popup = new L.popup();
         
                  //topojson
                  L.TopoJSON = L.GeoJSON.extend({  
                    addData: function(jsonData) {    
                      if (jsonData.type === "Topology") {
                        for (key in jsonData.objects) {
                          geojson = topojson.feature(jsonData, jsonData.objects[key]);
                          L.GeoJSON.prototype.addData.call(this, geojson);
                        }
                      }    
                      else {
                        L.GeoJSON.prototype.addData.call(this, jsonData);
                      }
                    }  
                  });
                  //topojson
            var wellmaxzoom = 13;       
          var polaruang_layer = new L.GeoJSON();
          var kabupaten_layer = new L.TopoJSON();
          var desa_layer = new L.TopoJSON();
              var bendung = new L.TopoJSON();
      
          var kegiatan = new L.TopoJSON();
          var permasalahan = new L.TopoJSON();
          var pintu_air = new L.TopoJSON();
          var sadap = new L.TopoJSON();
          var sawah = new L.TopoJSON();
          var saluran = new L.TopoJSON();
          var jalan_layer = new L.TopoJSON();
         
         
          
          //hapus labeh
          function hapus_label_kec(){
             var ii = 0;
                  kabupaten_layer.eachLayer(function (layer) {
                map.removeLayer(label_kec[ii]);
                // label[ii].clearLayers();
                 ii++;
              })
                  label_kec = [];
          }
          function tampil_label_kec(){
             var ii = 0;
                      kabupaten_layer.eachLayer(function (layer) {
                        label_kec[ii].setOpacity(1);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function hide_label_kec(){
             var ii = 0;
                      kabupaten_layer.eachLayer(function (layer) {
                        label_kec[ii].setOpacity(0);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }

          function hapus_label_desa(){
             var ii = 0;
                  desa_layer.eachLayer(function (layer) {
                   if(label_desa[ii]){
                    // map.removeLayer(label_desa[ii]);
                       label_desa[ii].setOpacity(0);
                   }
                
                // label[ii].clearLayers();
                 ii++;
              })
                 // label_desa = [];
          }
          function tampil_label_desa(){
             var ii = 0;
                      desa_layer.eachLayer(function (layer) {
                        label_desa[ii].setOpacity(1);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function hide_label_desa(){
             var ii = 0;
                      desa_layer.eachLayer(function (layer) {
                        label_desa[ii].setOpacity(0);
                    // label[ii].clearLayers();
                     ii++;
                  })
          }
          function loadGeoJsonkec(data) {
            hapus_label_kec();
            kabupaten_layer.clearLayers();
            kabupaten_layer.addData(data);

            kabupaten_layer.addTo(map);
            var i = 0;
            var labelnya = "";
             kabupaten_layer.eachLayer(function (layer) {

                  
                    layer.setStyle(style_kabupaten);
                    // layer.bindPopup(feature.properties.kabupaten);
                    // Get bounds of polygon
                    var bounds = layer.getBounds();
                    // Get center of bounds
                    var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                     label_kec[i] = new L.Tooltip({
                    noHide: false,
                    direction: 'auto',
                    permanent : true
                    });
                      labelnya = layer.feature.properties.kecamatan;
                     
                  label_kec[i].setContent(labelnya);
                  label_kec[i].setLatLng(center);
                 // label_kec[i].setOpacity(0);
                  map.showLabel(label_kec[i]);
                   layer.on('click', function (e) {
                                   //  panorama(e.latlng.lat, e.latlng.lng);
                                     // clickHandler(e)
                                      });
                  i++;
                    // layer.on("click", function (e) {
                    //       // var bounds = layer.getBounds();
                    //       // var popupContent = "popup content here";
                    //       // popup.setLatLng(bounds.getCenter());
                    //       // popup.setContent(popupContent);
                    //       // map.openPopup(popup);
                    //    //  $('#bs-example-modal-lg').modal('show');
                    //   });
             });
          }
          function loadGeoJsondesa(data) {

            hapus_label_desa();
            desa_layer.clearLayers();
            desa_layer.addData(data);
            desa_layer.addTo(map);
            var i = 0;
            var labelnya = "";
             desa_layer.eachLayer(function (layer) {

                  
                       layer.setStyle(style_desa);

                    // layer.bindPopup(feature.properties.kabupaten);
                    // Get bounds of polygonid_kel
                    var bounds = layer.getBounds();
                    // Get center of bounds
                    var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                     label_desa[i] = new L.Tooltip({
                    noHide: false,
                    direction: 'auto',
                    permanent : true
                    });
                      labelnya = layer.feature.properties.desa;
                     
                  label_desa[i].setContent(labelnya);
                  label_desa[i].setLatLng(center);
                  label_desa[i].setOpacity(0);
                  map.showLabel(label_desa[i]);
                   layer.on('click', function (e) {
                     // drawnItems.clearLayers();
                     // $('#konten_polaruang').empty()
                     //              $.ajax({
                     //                       type : "GET",
                     //                       async : false,
                     //                       global : false,
                     //                       url : root + "peta/list_polaruang_desa/"+layer.feature.properties.kode_d,
                     //                       dataType : 'json',
                     //                       success: function (data) {
                     //                     // console.log(data)
                     //                              var latlngss = layer.getLatLngs();
                     //                      // console.log(latlngss[0])
                     //                           var seeArea =  L.GeometryUtil.geodesicArea(latlngss[0]);
                     //                               seeArea = L.GeometryUtil.readableArea(seeArea, true, {})
                     //                     $('#tabel_kecamatan_desa').empty()
                     //                        $.each(data.admin, function(){

                     //                          $('#tabel_kecamatan_desa').append("<tr><td>"+this.kecamatan+"</td><td>"+this.desa+" ("+seeArea+")</td></tr>")
                     //                        })
                                           
                     //                      var i = 0;
                     //                        $('#tabel_polaruang').empty()
                     //                      $.each(data.pola_ruang, function(){
                     //                          var total = 0;
                     //                              $.each(this.irisan, function(){
                     //                                      if(this.polygon){

                     //                                       wkt.read(''+this.polygon+'');
                     //                                        var latlngss = wkt.toObject().getLatLngs();
                     //                                           var gambar = wkt.toObject();
                     //                                          gambar.setStyle(style_gambar);
                     //                                           drawnItems.addLayer(gambar);
                     //                                       //  console.log(this)
                     //                                       //  console.log(wkt.toObject().getLatLngs())
                     //                                           //hitung luas
                     //                                         if(wkt.toObject().getLatLngs().length > 1){
                     //                                           $.each(latlngss, function(index, value){
                     //                                            if(value.length > 1){
                     //                                              $.each(value, function(indexx, valuee){
                     //                                                var luas =  L.GeometryUtil.geodesicArea(valuee);
                     //                                                total = total + luas; 
                     //                                              })
                     //                                            }else{
                     //                                              var luas =  L.GeometryUtil.geodesicArea(value);
                     //                                                total = total + luas;  
                     //                                            }
                                                                  
                                                                  
                     //                                           })
                     //                                         }else{

                     //                                          var luas =  L.GeometryUtil.geodesicArea(latlngss[0]);
                                                              
                     //                                                total = total + luas;   
                     //                                         }
                     //                                      }
                                                                
                                                                         
                     //                              })
                     //                              if(total != 0){
                     //                                 total = L.GeometryUtil.readableArea(total, true, {})
                     //                               }else{
                     //                                total = "Kesalahan dalam Penghitungan!"
                     //                               }
                     //                               i = i + 1;
                     //                               // html = html + "<tr><td>Kategori Pola Ruang</td><td>:</td><td>"+this.rencana_tg+" ("+total+")</td></tr>"
                                                  
                     //                                $('#tabel_polaruang').append("<tr><td>"+i+"</td><td>"+this.rencana_tg+"  ("+total+")</td><td>"+this.pemanfaata+"</td><td>"+this.pengendali+"</td></tr>")

                     //                              // html = html + this.rencana_tg+" ("+total+")</br>";
                     //                       })
                     //                          $("#link_print").html('  <a class="btn btn-success visible-md visible-lg" href="/pola_ruang/cetak/'+layer.feature.properties.kode_d+'" role="button">Cetak Peta</a>')
                     //                         // $("#konten-detail").toggle("slide", {direction:"right"}, 500);
                     //                         $('.modal').modal('show');
                     //                       }
                     //                     });
                                      });
                  i++;
                    // layer.on("click", function (e) {
                    //       // var bounds = layer.getBounds();
                    //       // var popupContent = "popup content here";
                    //       // popup.setLatLng(bounds.getCenter());
                    //       // popup.setContent(popupContent);
                    //       // map.openPopup(popup);
                    //     // $('#bs-example-modal-lg').modal('show');
                    //   });
             });
             hapus_label_desa();
             map.removeLayer(drawnItems);
                       drawnItems.addTo(map);
          }
         function loadGeoJsonjalan(data) {
          
            jalan_layer.clearLayers();
            jalan_layer.addData(data);
            jalan_layer.addTo(map);
       
            var i = 0;
            var labelnya = "";
            jalan_layer.eachLayer(function (layer) {

                  
                   // layer.setStyle(style_sempadan_sungai);
                   // layer.bindPopup(layer.feature.properties.rencana_tg);
                    // Get bounds of polygon
                   // var bounds = layer.getBounds();
                    // Get center of bounds
                   // var center = bounds.getCenter();
                    //center.on('click', alert('asu'));
                    // Use center to put marker on map
                    //var marker = L.marker(center).addTo(map);
                    //labelnya
                    var stl = {
              color : "red", 
              weight : 3, 
              opacity : 1, 
              fillOpacity  : 0
            };
            layer.setStyle(stl);
             
                  i++;
                    layer.on("click", function (e) {
                          var bounds = layer.getBounds();
                          var nama_ruas = "Posisi : "+layer.feature.properties.nama_ruas;
                          popup.setLatLng(bounds.getCenter());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
             //    map.removeLayer(jalan_layer);
          }
        function loadGeoJsonsaluran(data) {
        
          saluran.clearLayers();
          saluran.addData(data);
          saluran.addTo(map);
        
          var i = 0;
          var labelnya = "";
          saluran.eachLayer(function (layer) {

            
                  var stl = {
            color : "cyan", 
            weight : 3, 
            opacity : 1, 
            fillOpacity  : 0
          };
          layer.setStyle(stl);
           
                i++;
                  layer.on("click", function (e) {
                        var bounds = layer.getBounds();
                        var popupContent = "Nama : "+layer.feature.properties.nm_sal;
                        popup.setLatLng(bounds.getCenter());
                        popup.setContent(popupContent);
                        map.openPopup(popup);
                     //  $('#bs-example-modal-lg').modal('show');
                    });
           });
           //    map.removeLayer(jalan_layer);
        }
          function loadGeoJsonkegiatan(data) {
          
            kegiatan.clearLayers();
            kegiatan.addData(data);
            kegiatan.addTo(map);
            var i = 0;
            var labelnya = "";
            kegiatan.eachLayer(function (layer) {

                 // layer.setOpacity(1)
                 var icn = L.ExtraMarkers.icon({
                prefix: 'fa', 
                markerColor: 'green-light', 
                icon: 'fa-building', 
                iconColor: 'white',
                shape: 'square'
            });
               
                layer.setIcon(icn);
                  i++;
                  
                    layer.on("click", function (e) {

                          var popupContent = "Jenis Kegiatan : "+layer.feature.properties.jenis;
                          popupContent += `<br>Kelurahan : ${layer.feature.properties.kel}`

                          popupContent += `<br>Nama Anggaran : ${layer.feature.properties.kegiatanPrioritas}`
                          popupContent += `<br>Jumlah Anggaran : ${numberWithCommas(layer.feature.properties.jumlahAnggaran)}`
                          popupContent += `<br><br><center><img src="/foto/${layer.feature.properties.foto1}" style="width:160px"></center>`
                          popup.setLatLng(layer.getLatLng());
                          popup.setContent(popupContent);
                          map.openPopup(popup);
                       //  $('#bs-example-modal-lg').modal('show');
                      });
             });
              //   map.removeLayer(penunjang);
          }
     
         
      
     

        

        

   




        


     


  // do stuff after marker has been added

    
  function doAnimations(){
     var myIcon = document.querySelector('.gps_ring')
    //sesudah
     myIcon.style.width = '1000px'
     
  }

          
             
               
                   

          //ambil kec
            var geoJsonUrl =root+"peta/topojson_kec"; 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonkec);
                //ambil polaruang
                
                var geoJsonUrl ="/kegiatan/peta/2021"; 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonkegiatan);
                var geoJsonUrl ="/kegiatan/jalan"; 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonjalan);
                 //ambil eksisting
           
                map.on('moveend', function(){
                 if(map.getZoom() > 10 && map.getZoom() < 14){
                       tampil_label_kec();
                 }else{
                  hide_label_kec();
                 }
               })
                  var kiri_atas_lng  = map.getBounds().getSouthWest().lng;
            var kiri_atas_lat  = map.getBounds().getSouthWest().lat;
            var kanan_bawah_lng = map.getBounds().getNorthEast().lng;
            var kanan_bawah_lat = map.getBounds().getNorthEast().lat;
               
                    
                   
                //end ambil_kec

          //saat pindah
        //  map.on('moveend', function(){
          // if(map.getZoom() > wellmaxzoom){
            //kembali ke asal

           
           //kembali ke asal

            var kiri_atas_lng  = map.getBounds().getSouthWest().lng;
            var kiri_atas_lat  = map.getBounds().getSouthWest().lat;
            var kanan_bawah_lng = map.getBounds().getNorthEast().lng;
            var kanan_bawah_lat = map.getBounds().getNorthEast().lat;
           //   var geoJsonUrl =root + "index.php/peta/geo_kec_bound/"+kiri_atas_lng+"/"+kiri_atas_lat+"/"+kanan_bawah_lng+"/"+kanan_bawah_lat; 
              var geoJsonUrl =root+"peta/topojson_desa?kiri_lng="+kiri_atas_lng+"&kiri_lat="+kiri_atas_lat+"&kanan_lng="+kanan_bawah_lng+"&kanan_lat="+kanan_bawah_lat; 
             // console.log(geoJsonUrl);
            // console.log(map.getBounds().toBBoxString());
            // console.log(map.getBounds().getSouthWest().lng + ';' + map.getBounds().getSouthWest().lat + ';' + map.getBounds().getNorthEast().lng + ';' + map.getBounds().getNorthEast().lat);
          //    var boundingBox = L.rectangle(map.getBounds(), {color: "#ff7800", weight: 1});
          // map.addLayer(boundingBox);
              // $.ajax({
              //     url: geoJsonUrl,
              //     datatype: 'json',
              //     jsonCallback: 'getJson',
              //     success: loadGeoJson
              //     });
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsondesa);

                      $("#id_kel").change(function() {
                       desa_layer.eachLayer(function (layer) {
                     //   console.log(layer.feature.properties.id_kelurahan == );
                        var bounds = layer.getBounds();
                        // Get center of bounds
                       // var center = bounds.getCenter();
                      if(layer.feature.properties.id_kelurahan == $("#id_kel").val()){
                                 map.fitBounds(bounds);
                      }
               
                       })
                     })

                
              // }else{
              // hapus_label_desa();
              //   map.removeLayer(desa_layer);
              // };
        //  });
            map.on('moveend', function(){
                    if(map.getZoom() > wellmaxzoom){
                      tampil_label_desa();
                            }else{
                            hapus_label_desa();
                           //   map.removeLayer(desa_layer);
                            };
                       });
          //end moveend

     legend.onAdd = function (map) {
              var div = L.DomUtil.create('div', 'info-legend')
             
             // loop through our density intervals and generate a label with a colored square for each interval
              for (var i = 0; i < warna_total.length; i++) {
                div.innerHTML += '<i style="background:' + warna_total[i] + '"></i> ' + labels[i] + '<br>';
              }
              return div;
            };

           legend.addTo(map);

            var baseLayers = {
              "Google Roadmap": google_roadmap,
              "Google Hybrid": google_hybrid,
              "Google Satellite": google_satelit,
              "Open Street Map": osm,
              "ESRI World Imagery": Esri_WorldImagery,
              "RBI": RBI
            };
            
            // var overlays = {
            //   "kecamatan": kabupaten_layer,
            //   "<span>RTRW Semapadan Sungai</span>&nbsp;&nbsp;<span style='background-color:#499277;padding:2px 8px 2px 8px;'></span>": sempadan_sungai,
            //   "<span>RTRW Sempadan Pantai</span>&nbsp;&nbsp;<span style='background-color:#3F786F;padding:2px 8px 2px 8px;'></span>": sempadan_pantai,
            //   "<span>RTRW Kawasan Konservasi/KA</span>&nbsp;&nbsp;<span style='background-color:#195344;padding:2px 8px 2px 8px;'></span>": kawasan_konservasi,
            //   "<span>RTRW Hutan Lindung</span>&nbsp;&nbsp;<span style='background-color:#8C8D88;padding:2px 8px 2px 8px;'></span>": hutan_lindung,
            //   "<span>RTRW Tambak</span>&nbsp;&nbsp;<span style='background-color:#48B3C5;padding:2px 8px 2px 8px;'></span>": tambak,
            //   "<span>RTRW Lahan Basah Kering</span>&nbsp;&nbsp;<span style='background-color:#C8DEB0;padding:2px 8px 2px 8px;'></span>": lahan_basah_kering,
            //   "<span>RTRW Permukiman Perkotaan</span>&nbsp;&nbsp;<span style='background-color:#E8B05D;padding:2px 8px 2px 8px;'></span>": permukiman_perkotaan,
            //   "<span>RTRW Permukiman Perdesaan</span>&nbsp;&nbsp;<span style='background-color:#E8B05D;padding:2px 8px 2px 8px;'></span>": permukiman_perdesaan,
            //   "<span>RTRW Perkebunan</span>&nbsp;&nbsp;<span style='background-color:#ABBC6E;padding:2px 8px 2px 8px;'></span>": perkebunan,
            //   "<span>RTRW Industri</span>&nbsp;&nbsp;<span style='background-color:#9E8986;padding:2px 8px 2px 8px;'></span>": industri,
            //   "<span>RTRW Hutan Produksi Terbatas</span>&nbsp;&nbsp;<span style='background-color:#7EA4D3;padding:2px 8px 2px 8px;'></span>": hutan_produksi_terbatas,
            //   "<span>RTRW Hutan Produksi</span>&nbsp;&nbsp;<span style='background-color:#7EA4D3;padding:2px 8px 2px 8px;'></span>": hutan_produksi,
            //   "<span>Jalan</span>&nbsp;&nbsp;<span style='background-color:red;padding:2px 8px 2px 8px;'></span>": jalan_layer
             
              
            // };
            
            // L.control.layers(baseLayers,overlays,{
            //   position : 'topright'
            // }, {'drawlayer':drawnItems}, { position: 'topleft', collapsed: false }).addTo(map);

                          var groupedOverlays = {
                                 "Administrasi": {
                   "&nbsp;&nbsp;&nbsp;&nbsp;Kecamatan": kabupaten_layer,
                  "&nbsp;&nbsp;&nbsp;&nbsp;Kelurahan/Desa": desa_layer,
                  
                   },
                   "Layer": {
                   
                
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Saluran</span>&nbsp;&nbsp;<span style='background-color:cyan;padding:2px 8px 2px 8px;'></span>": saluran,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Jalan Inspeksi</span>&nbsp;&nbsp;<span style='background-color:red;padding:2px 8px 2px 8px;'></span>": jalan_layer,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Areal Sawah</span>&nbsp;&nbsp;<span style='background-color:green;padding:2px 8px 2px 8px;'></span>": sawah,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bendung</span>&nbsp;&nbsp;": bendung,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Pintu Air</span>&nbsp;&nbsp;": pintu_air,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bangunan Sadap</span>&nbsp;&nbsp;": sadap,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Bangunan Penunjang</span>&nbsp;&nbsp;": penunjang,
                  // "&nbsp;&nbsp;&nbsp;&nbsp;<span>Permasalahan</span>&nbsp;&nbsp;": permasalahan
                   }
                 };
                       var options = {
         // Make the "Landmarks" group exclusive (use radio inputs)
        // exclusiveGroups: ["Landmarks"],
         // Show a checkbox next to non-exclusive group labels for toggling all
         collapsed:true,
         groupCheckboxes: false
       };
            L.control.groupedLayers(baseLayers, groupedOverlays, options).addTo(map);
         

            streetview.onAdd = function (map) {
              var div = L.DomUtil.create('div', 'sv')
             
             // loop through our density intervals and generate a label with a colored square for each interval
                div.innerHTML += '';
              
              return div;
            };

           // streetview.addTo(map);

            L.control.scale({
              position : 'bottomright',
              metric : true,
              imperial : false
            }).addTo(map);
            
            // lc = L.control.locate({
            //   position : 'topleft',
            //   follow : true,
            //   strings : {
            //     title : "Lokasi Anda",
            //     popup: "Anda berada di radius {distance} {unit} dari titik ini"
            //   },
            //   markerClass : L.marker,
            //   markerStyle : {icon: locateIcon},
            //   keepCurrentZoomLevel : true
            // }).addTo(map);

            map
              .on('startfollowing', function() {
                map.on('dragstart', lc._stopFollowing, lc);
              })
              .on('stopfollowing', function() {
                  map.off('dragstart', lc._stopFollowing, lc);
              });

            map.on('locationfound', onLocationFound);
            

            // map.on('moveend', function() { 
            //      console.log(map.getBounds());
            // });

            map.on('baselayerchange', function(e) {
              console.log(e.name);

              if ( e.name == 'Google Roadmap' || e.name == 'Open Street Map' || e.name == 'Mapbox Street') {
                kabupaten_layer.eachLayer(function (layer) {
               //   layer.setStyle(style_kabupaten_gelap);
                });
              }else{
                kabupaten_layer.eachLayer(function (layer) {
                  layer.setStyle(style_kabupaten);
                });
              }

            });
            
            //ganti kabupaten
            $('#search_maps').hide();


           // $('.leaflet-bottom.leaflet-left').hide();
            
            $('.leaflet-bar-part.leaflet-bar-part-single').click(function () {
             
            })
            

            //panorama
           var marker= "";
           var titik_panorama = null;
            function panorama(xe,ye){
               if(titik_panorama != null){
              map.removeLayer(titik_panorama);     
               }
               if(marker!=""){
                 map.removeLayer(marker);
                 
               }
                  titik_panorama = L.marker([xe, ye]).addTo(map);
               var fenway = new google.maps.LatLng(xe,ye);
                 var panoramaOptions = {
                   position: fenway,
                   pov: {
                     heading: 34,
                     pitch: 10
                   }
                 };
                 var panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions);
               
          }
          $('#tahun').val(new Date().getFullYear()+1).trigger('change')
          var geoJsonUrl ="/kegiatan/peta/"+ $('#tahun').val(); 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonkegiatan);
          $('#tahun').change(function(){
            var geoJsonUrl ="/kegiatan/peta/"+ $('#tahun').val(); 
              $.getJSON(geoJsonUrl)
                .done(loadGeoJsonkegiatan);
               
          })
    </script>
</body>

</html>